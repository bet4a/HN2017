<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Fetch acta images</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link href="https://fonts.googleapis.com/css?family=Roboto:400,400i,700,700i" rel="stylesheet">
		<style>
			html {
				box-sizing: border-box;
			}
			*, *:before, *:after {
				box-sizing: inherit;
			}
			body {
				color: #000;
				font-family: 'Roboto', sans-serif;
				margin: 0;
				font-weight: 400;
				font-size:100%;
			}
			#controls {		
				position: fixed;
				top: 0;
				left: 0;
				background-color: rgba(207,216,220,0.75);
				width: 100%;
				padding: 0.25rem;
				font-size: 1.25em;
			}
			#controls label {
				margin: 0 0.5em;
			}
			#controls input[type=submit] {
				font-size: 1em;
				margin: 0 0.5em;
				font-family: "Roboto";
			}
			#controls #actaIDField {
				font-size: 1em;
				font-family: "Roboto";
			}
			#image {
				margin-top: 1.5em;
			}
			#image img {
				min-width: 800px;
				width: 100%;
			}
			#image img.hidden {
				display: none;
			}
		</style>
	</head>
	<body>
		<div id="controls">
			<form id="actaForm">
				<label for="actaIDField">MER No: </label>
				<input id="actaIDField" type="number" min="1" max="18128" maxlength="5">
				<input type="submit" value="Go">
			</form>
		</div>
		<div id="image">
			<img id="actaOriginalImage" src="" class="hidden">
			<img id="actaSpecialResultadoImage" src="" class="hidden">
			<img id="actaSpecialEscrutinioImage" src="" class="hidden">
		</div>
		<script>
			(function() {
				'use strict';
				document.getElementById("actaForm").addEventListener("submit", (e) => {
					e.preventDefault();
					let actaID = Number.parseInt(document.getElementById("actaIDField").value);
					document.getElementById("actaOriginalImage").src = "";
					document.getElementById("actaSpecialResultadoImage").src = "";
					document.getElementById("actaSpecialEscrutinioImage").src = "";
					document.getElementById("actaOriginalImage").classList.remove("hidden");
					document.getElementById("actaSpecialResultadoImage").classList.remove("hidden");
					document.getElementById("actaSpecialEscrutinioImage").classList.remove("hidden");
					if (Number.isInteger(actaID) && actaID >= 1 && actaID <= 18128) {
						let fullActaID = actaID.toString().padStart(5, "0");
						let originalImageURL = "https://s3.amazonaws.com/uploadtrailhn/" + fullActaID + "104.JPG";
						let specialResultImageURL = "https://s3.amazonaws.com/uploadtrailhn/" + fullActaID + "159.JPG";
						let specialEscrutinioImageURL = "https://s3.amazonaws.com/uploadtrailhnespecial/" + fullActaID + "159.JPG";
						console.log(originalImageURL);
						document.getElementById("actaOriginalImage").src = originalImageURL;
						document.getElementById("actaSpecialResultadoImage").src = specialResultImageURL;
						document.getElementById("actaSpecialEscrutinioImage").src = specialEscrutinioImageURL;
					}
				});
				document.getElementById("actaIDField").addEventListener("click", (e) => {
					e.target.select();
				});
				["actaOriginalImage", "actaSpecialResultadoImage", "actaSpecialEscrutinioImage"].forEach((imgId) => {
					let img = document.getElementById(imgId);
					img.addEventListener("error", (e) => {
						img.classList.add("hidden");	
					});
					img.addEventListener("load", (e) => {
						let xmlhttp = new XMLHttpRequest();
						xmlhttp.open("HEAD", "https://cors-anywhere.herokuapp.com/" + e.path[0].src); 
						xmlhttp.onreadystatechange=function() {
							if(xmlhttp.readyState==4) { 
								console.log(xmlhttp.getAllResponseHeaders());
							}
						}
						xmlhttp.send(); 
					});
				});
			})();
		</script>
	</body>
</html>
