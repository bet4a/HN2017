<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Fetch acta images</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700" rel="stylesheet">
		<style>
			html {
				box-sizing: border-box;
				font-size: 16px;
			}
			*, *:before, *:after {
				box-sizing: inherit;
			}
			body {
				color: #000;
				background-color: #dee4e6;
				font-family: 'Roboto', sans-serif;
				margin: 0;
				font-weight: 400;
				font-size:100%;
			}
			#controls {		
				position: fixed;
				color: white;
				top: 0;
				left: 0;
				background-color: rgba(69,90,100,0.75);
				width: 100%;
				padding: 0.25rem;
				font-size: 1.25em;
				display: inline-block;
			}
			#controls label {
				margin: 0 0.5rem;
			}
			#controls input[type=submit] {
				font-size: 1em;
				margin: 0 0.5em;
				font-family: "Roboto";
			}
			#controls #actaIDField {
				font-size: 1em;
				font-family: "Roboto";
				width: 120px;
			}
			#images {
				margin-top: 3em;
			}
			#images img {
				min-width: 800px;
				width: 100%;
				margin-bottom: 1.5em;
			}
			#images .hidden {
				display: none;
			}
			h1 {
				font-size: 1.25em;
				margin-left: 0.75rem;
				margin-bottom: 0;
			}
			h2 {
				font-size: 1.125em;
				font-weight: 400;
				margin: 0;
				margin-left: 0.75rem;
			}
			a {
				text-decoration: none;
			}
			h1 a {
				color: #0091ea;
			}
			h1 a:hover {
				text-decoration: underline;
			}
			#controls #twitter_link {
				padding: 0.25rem;
				float: right; /* ðŸ˜© */
				font-size: 0.625em;
			}
			#controls #twitter_link i {
				width: 14px;
				height: 14px;
				background: transparent 0 0 no-repeat;
				background-image: url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2072%2072%22%3E%3Cpath%20fill%3D%22none%22%20d%3D%22M0%200h72v72H0z%22%2F%3E%3Cpath%20class%3D%22icon%22%20fill%3D%22%23fff%22%20d%3D%22M68.812%2015.14c-2.348%201.04-4.87%201.744-7.52%202.06%202.704-1.62%204.78-4.186%205.757-7.243-2.53%201.5-5.33%202.592-8.314%203.176C56.35%2010.59%2052.948%209%2049.182%209c-7.23%200-13.092%205.86-13.092%2013.093%200%201.026.118%202.02.338%202.98C25.543%2024.527%2015.9%2019.318%209.44%2011.396c-1.125%201.936-1.77%204.184-1.77%206.58%200%204.543%202.312%208.552%205.824%2010.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163%200%206.345%204.513%2011.638%2010.504%2012.84-1.1.298-2.256.457-3.45.457-.845%200-1.666-.078-2.464-.23%201.667%205.2%206.5%208.985%2012.23%209.09-4.482%203.51-10.13%205.605-16.26%205.605-1.055%200-2.096-.06-3.122-.184%205.794%203.717%2012.676%205.882%2020.067%205.882%2024.083%200%2037.25-19.95%2037.25-37.25%200-.565-.013-1.133-.038-1.693%202.558-1.847%204.778-4.15%206.532-6.774z%22%2F%3E%3C%2Fsvg%3E");
				display: inline-block;
				position: relative;
				top: 2px;
				margin-right: 3px;
			}
			#controls #twitter_link a {
				font-weight: 400;
				padding: 1px 8px 1px 6px;
				border-radius: 3px;
				background-color: #1b95e0;
				color: #fff;
			}
			#controls #twitter_link a:hover {
				background-color: #0c7abf;
				cursor: pointer;
			}
		</style>
	</head>
	<body>
		<div id="controls">
			<div id="twitter_link">
				Â¿necesitas algo mÃ¡s? need something else?&nbsp;&nbsp;&nbsp;<a href="https://twitter.com/intent/tweet?screen_name=bret_abel" target="_blank" rel="noopener noreferrer"><i></i>Twittear a @bret_abel</a>
			</div>
				<form id="actaForm">
					<label for="actaIDField">MER No: </label>
					<input id="actaIDField" type="number" min="1" max="18128">
					<input type="submit" value="Go">
				</form>
		</div>
		<div id="images">
			<h1 id="actaOriginalLabel" class="hidden">acta original <span style="font-weight:500;">(<a href="" target="_blank" rel="noopener noreferrer">resultadosgenerales2017.tse.hn</a>)</span></h1>
			<img id="actaOriginalImage" src="" class="hidden">
			
			<h1 id="actaSpecialResultadoLabel" class="hidden">acta de escrutinio especial <span style="font-weight:500;">(<a href="" target="_blank" rel="noopener noreferrer">resultadosgenerales2017.tse.hn</a>)</span></h1>
			<img id="actaSpecialResultadoImage" src="" class="hidden">
			
			<h1 id="actaSpecialEscrutinioLabel" class="hidden">acta de escrutinio especial <span style="font-weight:500;">(<a href="" target="_blank" rel="noopener noreferrer">escrutinioespecial.tse.hn</a>)</span></h1>
			<img id="actaSpecialEscrutinioImage" src="" class="hidden">
		</div>
		<script>
			(function() {
				'use strict';
				/*
				oh, noâ€¦ youâ€™re seeing how this works?
				look, i know how bad this code is.
				i was in a hurry, ok
				
				ya sÃ© que este cÃ³digo es un disastre. 
				
				*/
				let actaOrigImg = document.getElementById("actaOriginalImage");
				let actaOrigLbl = document.getElementById("actaOriginalLabel");
				
				let actaEsp1Img = document.getElementById("actaSpecialResultadoImage");
				let actaEsp1Lbl = document.getElementById("actaSpecialResultadoLabel");
				
				let actaEsp2Img = document.getElementById("actaSpecialEscrutinioImage");
				let actaEsp2Lbl = document.getElementById("actaSpecialEscrutinioLabel");
				
				let attemptImgLoad = function(imgEl, lblEl, URL, actaLink) {
					let xmlhttp = new XMLHttpRequest();
					xmlhttp.addEventListener("load", (e) => {
						if (xmlhttp.readyState === 4 && xmlhttp.status === 200) {
							let headerModified = document.createElement("h2");
							let date = new Date(xmlhttp.getResponseHeader("last-modified"));
							headerModified.innerHTML = "last-modified: " + "<span style='font-weight: 500'>" +  date.toLocaleString("arab", {timeZone: "America/Tegucigalpa", timeZoneName: "short"}) + "</span>";
							
							/*let headerSize = document.createElement("h2");
							headerSize.innerHTML = "tamaÃ±o: " + "??";*/
							imgEl.parentNode.insertBefore(headerModified, imgEl);
							imgEl.src = URL;
							imgEl.classList.remove("hidden");
							lblEl.classList.remove("hidden");
							lblEl.querySelector("a").href = actaLink;
						}
					});
					xmlhttp.open("HEAD", "https://dry-sierra-94326.herokuapp.com/" + URL); 
					xmlhttp.send(); 
				};
				
				document.getElementById("actaForm").addEventListener("submit", (e) => {
					e.preventDefault();
					document.querySelectorAll("#images h2").forEach((lmHeader) => {
						lmHeader.remove();
					});
					let actaID = Number.parseInt(document.getElementById("actaIDField").value);
					actaOrigImg.src = "";
					actaEsp1Img.src = "";
					actaEsp2Img.src = "";
					actaOrigImg.classList.add("hidden");
					actaEsp1Img.classList.add("hidden");
					actaEsp2Img.classList.add("hidden");
					actaOrigLbl.classList.add("hidden");
					actaEsp1Lbl.classList.add("hidden");
					actaEsp2Lbl.classList.add("hidden");
					if (Number.isInteger(actaID) && actaID >= 1 && actaID <= 18128) {
						let fullActaID = actaID.toString().padStart(5, "0");
						let originalImageURL = "https://s3.amazonaws.com/uploadtrailhn/" + fullActaID + "104.JPG";
						let specialResultImageURL = "https://s3.amazonaws.com/uploadtrailhn/" + fullActaID + "159.JPG";
						let specialEscrutinioImageURL = "https://s3.amazonaws.com/uploadtrailhnespecial/" + fullActaID + "159.JPG";
						
						attemptImgLoad(actaOrigImg, actaOrigLbl, originalImageURL, "https://resultadosgenerales2017.tse.hn/Acta.html?nivel=1&mer=" + actaID);
						attemptImgLoad(actaEsp1Img, actaEsp1Lbl, specialResultImageURL, "https://resultadosgenerales2017.tse.hn/Acta.html?nivel=1&mer=" + actaID);
						attemptImgLoad(actaEsp2Img, actaEsp2Lbl, specialEscrutinioImageURL, "https://escrutinioespecial.tse.hn/Acta.html?nivel=1&mer=" + actaID);
						
					}
				});
				[actaOrigImg, actaEsp1Img, actaEsp2Img].forEach((img) => {
					img.addEventListener("load", () => {
						let header = document.createElement("h2");
						header.innerHTML = "dimensiones: " + "<span style='font-weight: 500'>" +  img.naturalWidth + " Ã— " + img.naturalHeight + " (" + Math.round((img.naturalWidth*img.naturalHeight)/10000)/100 + " megapÃ­xeles)</span>";
						img.parentNode.insertBefore(header, img);
					});
				});
				if (window.navigator.userAgent.indexOf("Edge") <= -1) {
					document.getElementById("actaIDField").addEventListener("click", (e) => {
						e.target.select();
					})
				} else {
					let field = document.getElementById("actaIDField");
					field.removeAttribute("min");
					field.removeAttribute("max");
					field.setAttribute("type", "text");
				}
			})();
		</script>
	</body>
</html>
